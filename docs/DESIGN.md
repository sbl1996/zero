# ZERO R 游戏设计总览 V2.0

---

## 术语与符号

* **身体属性 Body**：`HP, QiMax, ATK, DEF, AGI, REC`
* **斗气 Qi**：战斗资源，`Qi ∈ [0, QiMax]`
* **斗气本源 BP**：隐藏绝对值，修炼/战斗行为驱动增长
* **境界 Realm**：一级→六级（无小境界），七级→九级（各含“初/中/高/巅”），圣域（“初/中/高/巅/极限”）
* **运转预热**：`F(t)=clamp(t/5s,0,1)`；凡 **Qi 派生**量在预热期按 `F(t)` 缩放
* **韧性 tough**：入减伤端；玩家=1.0，怪物=1.0，BOSS=1.5
* **随机口径**：`roll ~ U[0.8,1.2]`；UI对外四舍五入，内部累计到帧末再取整

---

## 1. 修炼与资源

### 1.1 境界与 BP 区间

为每个（小）境界定义 BP 区间 [BP_min, BP_max]。进度 p（0–1）线性映射到区间：

```
BP_current = BP_min + (BP_max - BP_min) * p
```

**区间**

| 大境界 | 小境界        | BP区间（含起止）                               | 备注                       |
| --- | ---------- | --------------------------------------- | ------------------------ |
| 一级  | —          | 100–200                                 |                          |
| 二级  | —          | 200–400                                 |                          |
| 三级  | —          | 400–800                                 |                          |
| 四级  | —          | 800–1,600                               |                          |
| 五级  | —          | 1,600–3,200                             |                          |
| 六级  | —          | 3,200–6,400                             |                          |
| 七级  | 初/中/高/巅    | 6,400–12,800（**每段+1,600**）              |                          |
| 八级  | 初/中/高/巅    | 12,800–25,600（**每段+3,200**）             |                          |
| 九级  | 初/中/高/巅    | 25,600–51,200（**每段+6,400**）             |                          |
| 圣域  | 初/中/高/巅/极限 | 51,200–102,400（前四段均分，**极限=区间顶+20%潜力池**） | 极限潜力池只触发部分被动，不线性推高 QiMax |

### 1.2 身体属性与功法

**身体（地基）**：

```
Body = { HP, QiMax, ATK, DEF, AGI, REC }
```

* 大境界提升采用“**先乘后加**”：
  * HP：+20% & +X，X依次为30/70/100/120/130/230/300/340/1000
  * ATK/DEF/AGI：各 +15% & +4/4/2
  * REC：+20% & +5
* **QiMax 与 BP**：`QiMax = 0.5 * BP_current`
* **初始档案**：境界=**一级**（p=0%），`BP≈100`；
  初始 Body 基线：`HP=100, ATK=10, DEF=10, AGI=10, REC=5`（可按职业细化）
  500 GOLD、生命药水×5、斗气药水×3、初始装备：无

### 1.3 斗气属性（Qi_*）与功法侧重

将 BP 转为单位后按功法自动分配（运转期受 `F(t)`）：

```
unit   = BP_current / K_bp2unit        # K_bp2unit = 5

Qi_ATK = unit * coef_ATK
Qi_DEF = unit * coef_DEF
Qi_AGI = unit * coef_AGI
ATK_final = Body_ATK + F(t)*Qi_ATK
DEF_final = Body_DEF + F(t)*Qi_DEF
AGI_final = Body_AGI + F(t)*Qi_AGI
```

**功法列表**：
* 星魂斗气（star_soul）
  * 描述：星魂一脉的古老传承，凝聚星辰之力运转斗气，攻守兼备，如星辉般稳定而坚韧。
  * 属性分配：0.40/0.40/0.20
* 金刚斗气（vajra）
  * 描述：传承自北方玄武神兽的不世绝学，取其长寿不灭、固若金汤之神髓，成就万劫不磨之身。
  * 属性分配：0.45/0.50/0.05
* 虎纹斗气（tiger_stripe）
  * 描述：传承自西方白虎神兽的杀伐绝学，取其庚金之锐利、白虎之威猛，剑锋所指，所向披靡。
  * 属性分配：0.50/0.10/0.40
  * 特性：
    * 猛虎下山：在对方技能后摇时击中敌人
* 紫焰斗气（purple_flame）
  * 描述：传承自南方朱雀神兽的不灭神火，取其浴火重生之玄妙，焚尽万邪，生生不息。
  * 属性分配：0.30/0.30/0.15 + **恢复 0.25**
  * 特性：
    * 不灭紫焰：斗气恢复速度翻倍。

### 1.4 修炼、瓶颈与突破

**BP 增长**：

* 冥想每秒钟增长BP
```
ΔBP = K_bp * K_env
K_bp=0.1, K_env：1.0
```

* 所有消耗斗气的行为可获得BP，公式如下（过于复杂，暂不启用）
```
ΔBP = K_bp * { K_env * (α * Qi_spent + β * Qi_restored) + K_actions }
K_bp=1e-5, α=1.0, β=0.5
K_env：普通1.0 / Boss1.2 / 木桩0.8 / 野外0.4 / 城内0.3 / 冥想0.2；战后余劲15min ×1.5
K_actions：普攻150 / 受击300 / 完美闪避800 / 终招1200 / 重伤坚持200（境界自适应缩放）
```

**突破**（小境界满即入池）：

* **强行突破**：清空 Qi，`P = (0.08-0.04p) * f_e * buffs`，单次 ≤35%
* **生死战**（战中判定，CD 0.5s）：`P = 0.03 * m_hp * m_chain * m_gap`，单次 ≤25%（暂不使用）
* **天材地宝 / 高人指点**：直接/放大概率（指点 ×1.15，30min 或成功一次失效）
  成功 → 进下一段，按本章**大境界乘加**改造身体；失败 → 保持瓶颈（强突失败 Qi 清零）

---

## 2. 斗气资源系统

### 2.1 运转与预热

进入运转→5s 达满 `F(t)`；动作会消耗 Qi，`Qi < 5%*QiMax` 自动退出；重开需重预热。

### 2.2 消耗与恢复

* **动作消耗**（按 QiMax）：见技能表
* **自然恢复**：

```
Qi/sec = (r0 + r1*REC_final) * state_mult * F_mult
r0=1.0, r1=0.06
state_mult：运转=1.0 / 非运转=1.5 / 冥想=3.0
F_mult：运转=F(t) / 非运转&冥想=1.0
```

* **紫焰·恢复被动**：`REC +20`（Body直加，不受F），Qi 恢复×`(1+0.2F)`；圣域极限：+10 REC 与冥想效率 +5%
* **HP 自然恢复**：`HP/sec = 0.1 * REC_final`；战斗中 ×0.5；Boss 场 ×0.25

### 2.3 斗气防御 & 斗气闪避

* **斗气防御**（运转中自动生效）
  * 固定吸收来伤的 60%；**Qi 代价**：吸收值×1.0；Qi 不足则按可吸收量折算后退出
* **斗气闪避技能**（主动帧技）
  * 不同闪避技能有不同的无敌窗口、后摇、冷却与消耗
  * 成功率success = clip(base * e^{-k*(ratio-1)}, 0, 1)，ratio=对手敏捷/我方敏捷
  * **斗气闪避**
    * base=1.0，k=log(0.8)/(2.0-1.5)，当ratio=1.5时，成功率开始<1.0，当ratio=2.0，为80%

### 2.4 资源回满触发

| 触发        |  HP |  Qi | 说明        |
| --------- | :-: | :-: | --------- |
| **突破成功**  |  ✔  |  ✔  | 过渡到新段后回满  |
| **战败复活**  |  ✔  |  ✔  | 失败结算后返回地图 |
| **胜利**    |  ✖  |  ✖  | 不回满；可直接重赛 |
| **退出/逃跑** |  ✖  |  ✖  | 仅清战斗态，不结算 |

---

## 3. 怪物系统

### 3.1 核心思路

* 怪物没有直接的ATK/DEF/AGI，而是由隐藏 `BP`与`特化类型`转化而来。
* 怪物**没有 QiMax**、没有运转预热、没有斗气防御、AGI直接进入“破绽机制”。

### 3.2 从 BP 到属性的换算

#### 特化类型

| 特化             | 说明        | (ATK, DEF, AGI) 系数 |
| -------------- | --------- | ------------------ |
| Balanced（均衡）   | 通用型，攻守兼备  | (0.40, 0.40, 0.20) |
| Attacker（攻击）   | 高输出，低防中速  | (0.55, 0.25, 0.20) |
| Defender（防御）   | 高减伤，输出偏低  | (0.30, 0.55, 0.15) |
| Agile（敏捷）      | 高速、破绽威胁   | (0.35, 0.20, 0.45) |
| Bruiser（重装）    | 压迫近战      | (0.50, 0.40, 0.10) |
| Skirmisher（游击） | 灵活快打      | (0.40, 0.20, 0.40) |
| Mystic（奥术）     | 均衡偏防，技能输出    | (0.35, 0.40, 0.25) |
| Crazy（疯狂）     | 极高攻，极脆    | (0.65, 0.10, 0.25) |

#### 公式与常量

```
unit = BP / K_mon               # K_mon = 5（怪物BP→单位值换算常数）

ATK = round(unit * coef_ATK * S_ATK)
DEF = round(unit * coef_DEF * S_DEF)
AGI = round(unit * coef_AGI * S_AGI)

S_ATK = 1.2
S_DEF = 1.0
S_AGI = 1.0
```

### 3.3 怪物设计
* **普通怪物**统一 tough=**1.0**；**BOSS** tough 默认 **1.5**（个别 BOSS可覆盖）。
* **攻击节奏**：普通怪 1.6s/次，BOSS 独立设计。
* `怪物数据`与`BOSS列表`见文档末尾表格。

---

## 4. 伤害与对抗

### 4.1 参考防御与穿透

* **参考防御常数 K**
  
  由**攻击方威胁等级**取表而来：

  ```
  K = DEF_ref(threat_tier_attacker)
  ```

  * `threat_tier_attacker`：基于**攻击方境界、rank（精英/首领等）与地图/词缀**综合评定的威胁等级。
  * 暂时仅基于攻击方境界：一到七级依次为25/45/75/127/224/405/750。

* **穿透（由攻击方决定）**

  ```
  PenPct = clamp(0.05 + 0.01*Realm_att + 0.03*rank_att, 0, 0.60)
  PenFlat = 来自技能/词缀的固定穿透（默认 0）
  ```

* **tough（目标韧性，入减伤端）**
  玩家=1.0，普通怪=1.0，BOSS=1.5（地图/词缀可在 0.5–2.0 范围微调）。

### 4.2 敏捷属性与破绽机制

**破绽机制**：敏捷将作为一项**相对属性**，决定攻击方发现并利用敌人弱点的能力。

```
# 1. 计算双方敏捷比
Ratio_AGI = AGI_final_def / AGI_final_att

# 2. 计算最终破绽率 (Chance_Weakness)
Chance_Weakness = 0.05 + 0.75 * clamp(1 - Ratio_AGI, 0, 1)^1.3
```

### 4.3 结算流程

**1) 命中前判定**
处于闪避窗口且判定成功 → 免伤；否则进入伤害管线。

**2) 物理主干**

```
# 原始伤害（攻击方面板与技能）
raw   = ATK_final * skill.mult * roll(0.8~1.2)

# 有效防御（防守方面板 - 攻击方穿透，再乘以目标韧性）
effDF = max(0, DEF_final - PenFlat) * (1 - PenPct) * tough_target

# 参考防御常数：按“攻击方威胁等级”取表
K     = DEF_ref(threat_tier_attacker)

# 标准化减伤曲线（f = 0.5 的平衡点）
mitig = K / (K + effDF)

# 基础伤害结果（进入斗气防御层前）
dmg   = round(raw * mitig)
```

**3) 破绽判定层**
基于双方的 `AGI_final` 计算破绽率，判定是否触发破绽伤害。
```
Chance_Weakness = F_Weakness(AGI_final_att, AGI_final_def) # 参考 4.2 节公式
IF roll(0,1) < Chance_Weakness:
    dmg = round(dmg * 1.5)  # 破绽伤害，固定+50%
```

**4) 斗气防御层**（若防守方处于“运转”状态则生效）
* 固定吸收来伤的 60%。
* **Qi 代价**：`吸收值 × 1.0`；Qi 不足则按余量吸收后退出运转。
* 余量进入 HP 扣减。

---

## 5. 技能系统

### 5.1 技能配置

* 战斗界面 4 槽（可重复装，同技能共享冷却）；资源类型：**无消耗 / Qi 消耗**；资源不足不可施放

# 5.2 技能等级

## 5.2.1 基本规则

* 适用对象：除`斗气闪避`外的全部可造成效果的技能（含伤害或明确命中判定的非伤害技）。
* 等级范围：基础为1级，各技能等级上限不同。
* 进度条：每次**使用**获得熟练度 `XP`；**XP 满** → 进入**瓶颈**；瓶颈期继续使用会触发**突破判定**，成功则 `LV+1`。

## 5.2.2 熟练度获取（每次使用）

```
ΔXP = clamp( round( X0 + B*base_cd + C*hit_bonus ), 1, 10 )
# 常量：X0 = 1.0,  B = 0.15,  C = 0.5
# base_cd：技能基础冷却（秒，取技能表“冷却”）
# hit_bonus：若该次使用命中（或生效）=1，否则=0
```

* **反刷衰减**：同一场战斗内，对**同一目标**的第 n 次连续使用：
  `ΔXP *= (0.95)^(n-1)`

## 5.2.3 瓶颈与突破

* 达到上限：`XP >= XP_CAP(LV)` ⇒ `at_cap = true`、`bt_stack = 0`（仅用于记录“瓶颈冲击层数”）。
* 瓶颈期每次使用进行突破判定：

```
P_break = min(0.35,  P0 + P_stack * bt_stack)
# 常量：P0 = 0.06（6%），P_stack = 0.03（每层+3%），单次上限 35%
# 失败：bt_stack += 1；成功：LV+1，XP=0，at_cap=false，bt_stack=0
```

## 5.2.4 经验上限（每级）

```
XP_CAP(L) = round( 80 * 1.25^(L-1) )
```

## 5.2.5 上限与境界软门槛

```
MaxLV_by_Realm:
  一级~三级：≤3
  四级~六级：≤5
  七级~九级：≤7
  圣域： ≤10
```

* 当角色境界不足时，使用技能不继续积累 `XP`（显示“已达当前上限”）。


### 5.3 技能列表

* 斗气闪避 (qi_dodge)
  * 消耗Qi 6%，冷却0.7s，无敌窗口0.4s，后摇0.3s
  * 成功躲避敌人伤害返 4% QiMax

* 龙息斩 (dragon_breath_slash)
  * 消耗Qi 2%，冷却2s，后摇0.2s
  * 基础倍率1.0
  * 等级1-10：每级+2%倍率、-2%CD；L3 破绽伤加成 +5%；L6 消耗×0.8；L10 命中后2s内下一次**陨龙击**CD -25%

* 陨龙击 (fallen_dragon_smash)
  * 消耗Qi 4%，冷却5s，蓄力0.2s，后摇0.2s
  * 基础倍率1.6
  * 等级1-10：每级+4%倍率、-2%CD；造成 0.1s 眩晕。
    * 眩晕期间可打断敌方当前攻击或蓄力动作（暂未加入需要蓄力的怪物技能，后续再补充）。

* 星界龙血破 (star_realm_dragon_blood_break)
  * 消耗Qi 10%，冷却16s，蓄力0.5s，后摇0.2s
  * 基础倍率4.5
  * 等级1-10：每级+15%倍率、-2%CD；触发时获得0.5s霸体；命中给8s易伤+10%

* 注：每级增加的倍率为绝对倍率加成，一级开始就有加成，即1级陨龙击倍率为1.6+0.04=1.64。

---

## 6. 装备与强化

### 6.1 槽位与互斥

头盔、左手（盾）、右手（武器）、双手武器（与双持互斥）、铠甲、戒指×2

### 6.2 主属性强化

* `L`为强化等级，`0 ≤ L ≤ 15`。
* 固定加成：
  `FlatBonus(L) = 0 (L=0)`；`L≥1: FlatBonus = round(BaseMain × flatCapMultiplier × FlatProgress(L))`
  默认 `flatCapMultiplier`：武器 25%，盾/铠 18%，其他 15%；`FlatProgress(1→15)=[0.07,0.15,0.22,0.30,0.38,0.48,0.58,0.68,0.78,0.86,0.92,0.96,0.98,0.99,1.00]`
* 百分比加成：
  `MainBonus(L)= 0.01×min(L,5) + 0.02×max(min(L-5,5),0) + 0.03×max(L-10,0)`
* 最终主属性：`FinalMain(L) = round((BaseMain + FlatBonus(L)) × (1 + MainBonus(L)))`
* UI：显示“基础 + 固定 + 百分比 → 总值”，并提示**下一等级**的两项增量。

### 6.3 强化区段表

| 等级段 L | 成功率 | 失败惩罚  |   掉级下限 | 消耗材料   |   消耗金币 |
| ----: | --: | ----- | -----: | ------ | -----: |
|   0–4 | 95% | 无掉级   |      — | 祝福宝石×1 |    500 |
|   5–9 | 80% | 掉 1 级 | **5** | 灵魂宝石×1 |  2,000 |
| 10–14 | 50% | 掉 2 级 | **10** | 奇迹宝石×1 | 10,000 |

> **口径**：`掉级下限=10` 表示 L≥10 失败后不会低于 10（保留“10级安全锚点”作为分段稳定点）。

### 6.4 背包换装

* 背包页可穿戴/卸下/丢弃（确认弹窗）；装备页**仅浏览**。
* 冲突自动退回背包；成功换装**即时重算属性/上限并写存档**。
* 限制：需满足装备等级；未来可能有容量上限，卸下/替换前需检查空间。

---

## 7. 战斗系统

### 7.1 流程

进入战斗即启动：玩家即时操作；怪物默认每 **X秒** 行动一次，不同怪物可能有不同的行动频率；任一方 HP≤0 即结算

### 7.2 退出战斗

按钮或切页即可退出；清状态与计时；不结算掉落与 GOLD；**HP/Qi 不回满**

### 7.3 胜败与自动重赛

* **胜利**：`GOLD += rewardGold`；BOSS 首杀解锁下一张野外地图；**0.8s** 后普通怪可自动重赛（**不回满 HP/Qi**）；BOSS 留场展示战利品，点击立绘可重赛（不回满）
* **失败**：`GOLD -= floor(GOLD/3)`；随后 **回满 HP 与 Qi** 并返回地图
* **RNG**：统一 32 位种子；掉落与强化也纳入统一 RNG 序列以复现

### 7.4 消耗品

| ID                              | 名称         | 功能            |                 单价 |
| ------------------------------- | ---------- | ------------- | -----------------: |
| potionHP                        | 生命药水Ⅰ       | 回复 **100 HP** |                 50 |
| potionQi                        | 斗气药水Ⅰ       | 回复 **120 Qi** |                120 |
| potionQiPlus                    | 斗气药水Ⅱ     | 回复 **240 Qi** |                240 |
| coreShardTier1~9                | X级晶核       | 冥想时使用，10s内+BP/s | 100~25,600 |
| blessGem / soulGem / miracleGem | 祝福/灵魂/奇迹宝石 | 强化素材（§6）      | 1000 / 2000 / 5000 |

**快捷物品栏**（底部 4 槽）：点击即生效，统一 10s 冷却；不同物品分开计时；默认绑定：生命Ⅰ/斗气Ⅰ/斗气Ⅱ/（空）

### 7.5 晶核系统

**晶核**：修炼加速消耗品，仅在冥想状态下使用。

#### 等级与效果
* **9个等级**：一到九级，对应怪物境界等级
* **加成公式**：`1 × 2^(等级-1)` BP/s（一级+1/s，九级+256/s）
* **持续时间**：固定 **10秒**
* **价格公式**：`100 × 2^(等级-1)` 金币

#### 获取方式
* **战斗掉落**：怪物胜利后概率获得
  * 普通怪物：**20%** 掉落概率
  * 精英怪物：**45%** 掉落概率
  * Boss怪物：**90%** 掉落概率
* **掉落等级**：晶核等级 = 怪物境界等级（一到九级）

#### 使用机制
* **前置条件**：必须处于冥想状态
* **使用效果**：激活后获得额外BP/s加成，10秒后自动失效
* **状态管理**：同时只能激活一个晶核效果，高等级会覆盖低等级


---

## 8. 掉落与经济

### 8.1 掉落槽

* 普通怪：70% 无；25% 1 槽；5% 2 槽（期望 0.35）
* BOSS：保底 **2 槽**；另 30% +1，10% 再 +1（期望 ≈2.4）

### 8.2 槽内类型

* 普通怪：以**药水 / 装备 / 金币包**为主；不产宝石
* BOSS：每槽独立抽 **装备 55% / 宝石 25% / 金币包 20%**

  * 装备“**越阶概率**”30%（至少为当前段位）；**预强化**：BOSS 装备 2–5 级等概率（普通 0–2）

### 8.3 商店

* **消耗品**：无限量（见 §4.3）
* **装备**：仅售入门系列（Iron/Steel）
* **宝石**：祝福宝石开局可买；灵魂宝石在击败**高阶（≥七级）BOSS**后解锁；奇迹宝石在**圣域 BOSS**后解锁

---

## 9. 任务系统

### 9.1 核心概念

* **任务（Quest）**：由NPC或任务板发布，玩家主动接受与提交。
* **目标（Objective）**：任务的细化条件，详见任务类型。
* **状态（State）**：未解锁 → 可接受 → 已接受 → 可交付（完成未提交）→ 已完成 / 已放弃。

### 9.2 任务生命周期

1. **解锁**
   * 某些任务需要满足前置条件后才可接受。
   * 条件示例：
     * 玩家境界 ≥ 某阈值。
     * 首杀某BOSS后解锁一批新任务。
     * 完成前置任务链后开放后续任务。

2. **接受**
   * 玩家在NPC对话或任务板界面手动点击“接受”。
   * 接受后：
     * 对应目标开始计数。
     * 若为“收集任务物品”，从此刻起开启 **任务物品掉落逻辑**。

3. **进行中**
   * 任务界面显示当前进度。完成或部分完成目标时即时更新。

4. **达成**
   * 所有目标满足 → 状态切换为“可交付”。
   * 玩家需要返回任务来源（或指定交付NPC）提交。

5. **提交/完成**
   * 结算奖励，更新任务链进度，解锁后续任务/地图/商店内容。

6. **放弃（可选）**
   * 玩家手动放弃任务：
     * 清除任务进度。
     * 本阶段简化处理：**已获得的任务物品直接销毁**，防止后续计数混乱。
   * 某些关键任务可以设置为**不可放弃**。

### 9.3 任务类型

* 击杀 X 只 Y 怪物（KillXMonster）
  * 必须在任务被接受之后的击杀才计数。
* 获取 X 个 Y 物品（KillCollectXItem）
  * 任务物品只在任务已接受时有概率掉落。
    * 未接受任务时，怪物不掉该任务物品。
    * 任务完成/放弃后，相关任务物品停止掉落。
  * 任务物品为**非交易、非普通掉落表**的独立类别：
    * 不占用普通掉落槽（避免打乱原有掉落与经济）。
    * 采用“任务叠加掉落层”：判定任务物品之前先走普通掉落。
  * 掉落配置：
    * 任务物品ID：例如“史莱姆凝胶样本 (Slime Gel Sample)”。
    * 掉落怪物集：一般是 1~2 种指定怪物（如仅史莱姆，但也可以“史莱姆或黄金绵羊”）。
    * 基础掉率：例如 40%、60% 等，可随任务等级增加而调低。
    * 每次击杀最多掉落 1 个同类任务物品（防止单次爆出过多秒完任务）。
  * 失败与多次接取
    * 放弃任务时：**自动销毁背包内相关任务物品**。
    * 再次接取时：重新从 0 计数，不保留旧物品。

### 9.5 奖励与难度标记

* **基础奖励构成**：
  * GOLD：覆盖玩家在该任务预期战斗中的药水消耗，并略有盈余。
  * 消耗品：生命药水Ⅰ / 斗气药水Ⅰ/Ⅱ，视难度补一点缓冲。
  * 晶核：作为“修炼加速”的长线奖励，用于鼓励挑战更高阶怪。

* **难度标记**：
  * ★：预计 3–5 分钟内完成的简单任务。
  * ★★：预计 5–10 分钟，或需要进入稍高危险区域。
  * ★★★：地图后段区域或与精英/BOSS相关。

### 9.6 任务列表

#### 青苔原的黏液祸患

* **任务名**：青苔原的黏液祸患
* **任务类型**：击杀 X 只 Y 怪物（KillXMonster）
* **推荐境界**：一级
* **领取地点**：翡冷翠任务板
* **可重复接取**：是
* **发布者**：青苔原生态管理员
* **任务描述**：
  “最近青苔原边缘到处都是史莱姆的粘液印记，路过的行人被它们缠得寸步难行。帮忙清理一批吧，别让那些软泥团以为这片草地是它们的王国。”
* **目标**：
  * 在 **青苔原** 击杀 **10只史莱姆**
* **失败条件**：无（可随时放弃）
* **完成奖励**：
  * GOLD +80
  * 生命药水Ⅰ ×1
  * 斗气药水Ⅰ ×1
* **难度标记**：★

#### 野狼利齿样本

* **任务名**：野狼利齿样本
* **任务类型**：获取 X 个 Y 物品（KillCollectXItem）
* **推荐境界**：一级
* **领取地点**：翡冷翠任务板
* **可重复接取**：是
* **发布者**：铁匠罗恩
* **任务描述**：
  “那些在夜里嚎叫的野狼总是在铁矿道附近徘徊，我想看看它们的牙齿是不是被矿粉磨得更锋利。帮我带些利齿回来，我可以给你打折——当然，只是‘一点点’。”
* **目标**：
  * 收集 **5 个『野狼利齿』** 任务物品
* **任务物品掉落规则**：
  * 任务物品名：**野狼利齿**
  * 掉落怪物：仅 **野狼**
  * 掉率：基础 60% / 只
  * 掉落方式：额外任务掉落，不占普通掉落槽
  * 仅在任务“已接受”状态下才有掉落判定；任务完成或放弃后即不再掉落。
* **完成奖励**：
  * GOLD +120
  * 斗气药水Ⅰ ×2
  * 一级晶核 ×1
* **难度标记**：★☆

#### 寒岩碎核调查
* **任务名**：寒岩碎核调查
* **任务类型**：获取 X 个 Y 物品（CollectXItem）
* **推荐境界**：二级
* **领取地点**：翡冷翠任务板
* **可重复接取**：是
* **发布者**：远行学者米洛
* **任务描述**：
  “熔冰之脊的寒岩巨像似乎不是天然形成的岩石，它们体内有一种奇特的晶核，在冰与火之间不断震荡。帮我敲下一些碎核，我想研究它们与晶核修炼之间的关系。”
* **目标**：
  * 收集 **3 个『寒岩碎核』** 任务物品
* **任务物品掉落规则**：
  * 任务物品名：**寒岩碎核**
  * 掉落怪物：寒岩巨像
  * 掉率：基础 50% / 只
  * 掉落方式：额外任务掉落，不占普通掉落槽
  * 仅在任务“已接受”状态下才有掉落判定。
* **完成奖励**：
  * GOLD +260
  * 斗气药水Ⅱ ×1
  * 二级晶核 ×1
* **难度标记**：★★

---

## 10. 地图系统

* 地图页为默认落点：左侧列表 / 右侧根据地图类型切换布局
* 城市地图：地点标记按钮（百分比坐标）
* 野外地图：人物状态 + 底图 + 怪物标记；点击即战斗，结算后返回
* 锁定：首个城市与首个野外默认解锁；其余野外需对应 **BOSS 首杀** 解锁
* 路由刷新回到最近一次的可用地图

---

## 11. UI 与可视化

* **境界条**：显示当前段与小境界进度；满值高亮“瓶颈”，弹出可选突破途径与成功率修正
* **斗气环**：显示 `Qi/QiMax`、运转/预热 `F(t)`、低蓝警示（<5%）
* **面板区**：

  * 身体属性（HP/QiMax/ATK/DEF/AGI/REC）
  * 斗气加成（运转有效值与理论值对照：`F(t)*Qi_ATK/DEF/AGI`）
* **成长提示**：突破率弹出 “+” 提示
* **战斗时间线**：
  * 位置：战斗界面底部技能条上方，横向占满；战斗开始即启用；退出战斗（§6.2）时重置
  * 刻度：默认 6.0s 视图（12 格，每格 0.5s）；时间向右滚动，当前帧用竖线标记；暂停逻辑沿用调试工具
  * 轨道：双轨展示——上轨绑定玩家 4 槽与基础互动，下轨绑定敌方动作与环境事件（如陷阱、地图技）
  * 玩家轨：按技能槽顺序堆叠色块，块长 = 动作前摇+施放时间；冷却阶段以浅色描边延伸至下一次可施放节点；自动施法模式下补入重复排程
  * 敌方轨：按实体列出；怪物普攻节奏预先排入；读条技与 Boss 技能以加粗描边强调；提供 0.4s “完美闪避窗”半透明覆盖
  * 资源反馈：当 `Qi < cost` 或预热 `F(t)` 未达阈值时，同步点亮黄色警示；触发斗气防御时在对应时间段插入 90% 吸收条
  * 交互：鼠标悬停显示 tooltip（技能名/伤害/消耗/预计命中时间）；点击玩家块可快速切换到该技能槽；键盘/手柄不增设额外操作

---

## 12. 调参起点

* **BP→单位**：`K_bp2unit = 5`
* **突破**：强突 `P0=0.08-0.04p`（≤35%）；导师 ×1.15
* **运转**：预热 5s；退出阈值 5% QiMax；成本 1/3/7/12% QiMax；闪避 6%（成功返 4%）
* **恢复**：`Qi/sec=(1+0.06*REC)*state_mult*F_mult`；紫焰×`(1+0.2F)`、`REC+20`；HP 自然恢复 `0.1*REC`（战中×0.5、Boss×0.25）
* **防御**：斗气防御固定吸收来伤的 60%，Qi 代价=吸收×1.0
* **对抗**：`PenPct = clamp(0.05 + 0.01*Realm + 0.03*rank, 0, 0.60)`；`PenFlat` 由技能/装备提供
* **减伤曲线**：平衡点 f=0.5，`K=DEF_ref(realm_stage)`；tough：玩家1.0/怪1.0/BOSS1.5（0.5~2.0 浮动）

---

## 游戏数据库

### 装备列表
| 槽位 | id | 英文名称 | 等级需求 | 主属性 | 副属性 | 价格(GOLD) |
|------|---|---|---:|---|---|---:|
| 右手武器 | iron-sword | 铁剑 | 1 | ATK 10 | +3 ATK | 300 |
| 双手武器 | iron-maul | 铁锤 | 1 | ATK 16 | +4 ATK | 500 |
| 左手盾 | iron-shield | 铁盾 | 1 | DEF 10 | +2 DEF | 250 |
| 铠甲 | iron-plate | 铁甲 | 1 | DEF 15 | +2 DEF, +20 HP | 400 |
| 头盔 | iron-helm | 铁盔 | 1 | DEF 8 | +1 DEF | 200 |
| 戒指 | iron-ring | 铁戒指 | 1 | HP 30 | +5 HP | 220 |
| 右手武器 | steel-blade | 钢刃 | 10 | ATK 18 | +3 ATK | 600 |
| 双手武器 | steel-greatsword | 巨型钢剑 | 10 | ATK 30 | +4 ATK | 1000 |
| 左手盾 | steel-bulwark | 钢盾 | 10 | DEF 16 | +2 DEF | 500 |
| 铠甲 | steel-cuirass | 钢甲 | 10 | DEF 24 | +2 DEF, +20 HP | 800 |
| 头盔 | steel-helm | 钢盔 | 10 | DEF 13 | +1 DEF | 400 |
| 戒指 | amber-ring | 琥珀戒 | 10 | HP 48 | +5 HP | 440 |
| 右手武器 | knight-blade | 骑士刃 | 20 | ATK 24 | +3 ATK | 1050 |
| 双手武器 | knight-warhammer | 骑士战锤 | 20 | ATK 40 | +4 ATK | 1750 |
| 左手盾 | knight-tower-shield | 骑士塔盾 | 20 | DEF 22 | +2 DEF | 875 |
| 铠甲 | knight-armor | 骑士甲 | 20 | DEF 33 | +2 DEF, +20 HP | 1400 |
| 头盔 | knight-helm | 骑士盔 | 20 | DEF 18 | +1 DEF | 700 |
| 戒指 | ruby-ring | 红玉戒 | 20 | HP 66 | +5 HP | 770 |
| 右手武器 | mithril-saber | 秘银军刀 | 30 | ATK 32 | +3 ATK | 1800 |
| 双手武器 | mithril-claymore | 秘银巨剑 | 30 | ATK 56 | +4 ATK | 3000 |
| 左手盾 | mithril-aegis | 秘银盾 | 30 | DEF 31 | +2 DEF | 1500 |
| 铠甲 | mithril-hauberk | 秘银甲 | 30 | DEF 46 | +2 DEF, +20 HP | 2400 |
| 头盔 | mithril-coif | 秘银盔 | 30 | DEF 25 | +1 DEF | 1200 |
| 戒指 | sapphire-ring | 蓝宝石戒 | 30 | HP 93 | +5 HP | 1320 |
| 右手武器 | runed-edge | 符文之锋 | 40 | ATK 40 | +3 ATK | 2700 |
| 双手武器 | runed-greataxe | 符文巨斧 | 40 | ATK 75 | +4 ATK | 4500 |
| 左手盾 | runed-bulwark | 符文壁垒 | 40 | DEF 42 | +2 DEF | 2250 |
| 铠甲 | runed-cuirass | 符文甲 | 40 | DEF 63 | +2 DEF, +20 HP | 3600 |
| 头盔 | runed-helm | 符文头盔 | 40 | DEF 34 | +1 DEF | 1800 |
| 戒指 | topaz-ring | 黄玉戒 | 40 | HP 126 | +5 HP | 1980 |
| 右手武器 | dragonbone-fang | 龙骨之牙 | 50 | ATK 54 | +3 ATK | 3900 |
| 双手武器 | dragonslayer | 屠龙者 | 50 | ATK 96 | +4 ATK | 6500 |
| 左手盾 | dragonbone-shield | 龙骨盾 | 50 | DEF 52 | +2 DEF | 3250 |
| 铠甲 | dragonscale-armor | 龙鳞甲 | 50 | DEF 78 | +2 DEF, +20 HP | 5200 |
| 头盔 | dragonbone-helm | 龙骨盔 | 50 | DEF 42 | +1 DEF | 2600 |
| 戒指 | emerald-ring | 祖母绿戒 | 50 | HP 156 | +5 HP | 2860 |
| 右手武器 | radiant-sword | 辟光剑 | 60 | ATK 64 | +3 ATK | 5400 |
| 双手武器 | starbreaker | 碎星者 | 60 | ATK 116 | +4 ATK | 9000 |
| 左手盾 | celestial-bulwark | 天穹壁垒 | 60 | DEF 64 | +2 DEF | 4500 |
| 铠甲 | starlit-plate | 星辉甲 | 60 | DEF 96 | +2 DEF, +20 HP | 7200 |
| 头盔 | starcrest | 星冕 | 60 | DEF 51 | +1 DEF | 3600 |
| 戒指 | morningstar-ring | 晨星戒 | 60 | HP 192 | +5 HP | 3960 |

### 怪物数据

| ID                      | 名称                         | 等阶 | HP   | BP   | 特化       | GOLD | BOSS | 所属地图                       |
|-------------------------|------------------------------|------|------|------|------------|------|------|--------------------------------|
| `m-slime`               | 史莱姆 (Slime)               | 一级 | 80   | 100  | Balanced   | 25   |      | 青苔原 (fringe)                |
| `m-wolf`                | 野狼 (Wolf)                  | 一级 | 130  | 120  | Skirmisher | 35   |      | 青苔原 (fringe)                |
| `m-goblin`              | 哥布林 (Goblin)              | 一级 | 180  | 140  | Attacker   | 55   |      | 青苔原 (fringe)                |
| `m-boar`                | 巨型野猪 (Boar)              | 一级 | 260  | 160  | Bruiser    | 70   |      | 青苔原 (fringe)                |
| `boss-golden-sheep`     | 黄金绵羊 (Golden Sheep)      | 一级 | 800  | 200  | Defender   | 300  | ✔    | 青苔原 (fringe)                |
| `m-ice-boli`            | 冰玻力 (Ice Boli)            | 二级 | 460  | 240  | Defender   | 140  |      | 熔冰之脊 (spine-of-frostfire)  |
| `m-pyro-fox`            | 火焰狐 (Pyro Fox)            | 二级 | 520  | 300  | Skirmisher | 165  |      | 熔冰之脊 (spine-of-frostfire)  |
| `m-froststone-colossus` | 寒岩巨像 (Stone Golem)       | 二级 | 780  | 340  | Defender   | 210  |      | 熔冰之脊 (spine-of-frostfire)  |
| `boss-wind-raptor`      | 风暴迅猛龙 (Wind Raptor)     | 二级 | 1600 | 400  | Agile      | 600  | ✔    | 熔冰之脊 (spine-of-frostfire)  |
| `m-shade`               | 影子刺客 (Shade)             | 三级 | 980  | 480  | Agile      | 330  |      | 雷隐堡垒 (thunderveil-keep)    |
| `m-thunder-knight`      | 雷霆骑士 (Thunder Knight)    | 三级 | 1200 | 600  | Defender   | 420  |      | 雷隐堡垒 (thunderveil-keep)    |
| `m-abyss-witch`         | 深渊女巫 (Abyss Witch)       | 三级 | 1350 | 680  | Mystic     | 500  |      | 雷隐堡垒 (thunderveil-keep)    |
| `boss-dragon-whelp`     | 幼龙 (Dragon Whelp)          | 三级 | 2200 | 800  | Balanced   | 610  | ✔    | 雷隐堡垒 (thunderveil-keep)    |
| `m-specter`             | 沼泽魅影 (Marsh Specter)     | 四级 | 1622 | 880  | Crazy      | 378  |      | 腐沼根海 (bogroot-expanse)     |
| `m-rockback`            | 岩背巨兽 (Marsh Rockback)    | 四级 | 1682 | 1000 | Bruiser    | 391  |      | 腐沼根海 (bogroot-expanse)     |
| `m-raven`               | 血鸦 (Marsh Blood Raven)     | 四级 | 1785 | 1080 | Skirmisher | 415  |      | 腐沼根海 (bogroot-expanse)     |
| `boss-treant`           | 腐沼树妖 (Bog Treant)        | 四级 | 2676 | 1200 | Defender   | 535  | ✔    | 腐沼根海 (bogroot-expanse)     |
| `m-nightstalker`        | 夜巡狼人 (Nightstalker)      | 四级 | 1906 | 1220 | Agile      | 441  |      | 暮影裂谷 (duskfang-rift)       |
| `m-troll`               | 寒霜巨魔 (Frost Troll)       | 四级 | 1967 | 1360 | Bruiser    | 454  |      | 暮影裂谷 (duskfang-rift)       |
| `m-hound`               | 熔岩猎犬 (Lava Hound)        | 四级 | 2070 | 1480 | Attacker   | 477  |      | 暮影裂谷 (duskfang-rift)       |
| `boss-priest`           | 暗影祭司 (Shadow Priest)     | 四级 | 3088 | 1600 | Mystic     | 612  | ✔    | 暮影裂谷 (duskfang-rift)       |
| `m-harvester`           | 骨响收割者 (Bone Harvester)  | 五级 | 2190 | 1760 | Attacker   | 503  |      | 暗辉法枢 (gloomlit-arcanum)    |
| `m-sentinel`            | 符文哨兵 (Rune Sentinel)     | 五级 | 2233 | 2000 | Defender   | 513  |      | 暗辉法枢 (gloomlit-arcanum)    |
| `m-reaver`              | 虚空撕裂者 (Void Reaver)     | 五级 | 2354 | 2180 | Crazy      | 540  |      | 暗辉法枢 (gloomlit-arcanum)    |
| `boss-archmage`         | 堕落大法师 (Fallen Archmage) | 五级 | 3500 | 2400 | Mystic     | 690  | ✔    | 暗辉法枢 (gloomlit-arcanum)    |
| `m-stormcaller`         | 风暴召唤者 (Stormcaller)     | 五级 | 2457 | 2580 | Mystic     | 563  |      | 黑曜风痕 (obsidian-windscar)   |
| `m-colossus`            | 黑曜巨像 (Obsidian Colossus) | 五级 | 2517 | 2800 | Defender   | 576  |      | 黑曜风痕 (obsidian-windscar)   |
| `m-titan`               | 焰生泰坦 (Flameborn Titan)   | 五级 | 2638 | 2980 | Bruiser    | 602  |      | 黑曜风痕 (obsidian-windscar)   |
| `boss-knight`           | 恐惧骑士 (Dread Knight)      | 五级 | 3887 | 3200 | Bruiser    | 765  | ✔    | 黑曜风痕 (obsidian-windscar)   |
| `m-chimera`             | 秘能奇美拉 (Arcane Chimera)  | 六级 | 2741 | 3600 | Balanced   | 625  |      | 霜焰裂潮 (frostfire-maelstrom) |
| `m-wyrm`                | 冰霜飞龙 (Frost Wyrm)        | 六级 | 2801 | 4000 | Attacker   | 638  |      | 霜焰裂潮 (frostfire-maelstrom) |
| `m-kraken`              | 深海巨妖 (Abyss Kraken)      | 六级 | 2922 | 4360 | Bruiser    | 664  |      | 霜焰裂潮 (frostfire-maelstrom) |
| `boss-warlord`          | 地狱军阀 (Infernal Warlord)  | 六级 | 4299 | 4800 | Bruiser    | 842  | ✔    | 霜焰裂潮 (frostfire-maelstrom) |
| `m-templar`             | 天穹圣卫 (Celestial Templar) | 六级 | 3025 | 5140 | Defender   | 687  |      | 星界王座 (astral-crown)        |
| `m-banshee`             | 灰烬魅灵 (Ashen Banshee)     | 六级 | 3086 | 5480 | Mystic     | 700  |      | 星界王座 (astral-crown)        |
| `m-hunter`              | 苍穹狩魔者 (Skyscour Hunter) | 六级 | 3207 | 6000 | Agile      | 727  |      | 星界王座 (astral-crown)        |
| `boss-dragon`           | 远古龙王 (Ancient Dragon)    | 六级 | 4600 | 6400 | Balanced   | 923  | ✔    | 星界王座 (astral-crown)        |
| `m-faerie`              | 森灵妖精 (Forest Faerie)     | 七级 | 3150 | 6640 | Agile      | 735  |      | 绿野仙境 (green-elysium)       |
| `m-bloomfiend`          | 绽灵花魔 (Bloomfiend)        | 七级 | 3220 | 7200 | Mystic     | 750  |      | 绿野仙境 (green-elysium)       |
| `m-dreamstag`           | 梦角鹿 (Dream Stag)          | 七级 | 3305 | 7920 | Balanced   | 768  |      | 绿野仙境 (green-elysium)       |
| `m-sylvan-sentinel`     | 森域守卫 (Sylvan Sentinel)   | 七级 | 3400 | 8760 | Agile      | 785  |      | 绿野仙境 (green-elysium)       |
| `boss-queen-of-blooms`  | 绽辉女王 (Queen of Blooms)   | 七级 | 4950 | 9600 | Defender   | 970  | ✔    | 绿野仙境 (green-elysium)       |


### BOSS列表
通用规则：

* **tough = 1.5**（可覆写）。
* **普通攻击**：倍率 1.0×，冷却1.6s，后摇0.4s。所有怪物的默认技能。
* **特殊技能**：某些怪物有特殊技能，所有技能独立冷却。
* **怪物AI**：所有普通怪物的默认AI是一直释放“普通攻击”（冷却好就放），BOSS有特殊 AI 规则。
* 穿透、K 常数与全局伤害管线保持一致（§4）。

#### 黄金绵羊（一级 BOSS）

* **tough**：1.5
* 特殊技能**二连突刺**：二连击，每击倍率 0.6×，间隔 0.25s，冷却10s，后摇0.6s。
* AI：**二连突刺**冷却好时有20%概率释放，否则释放“普通攻击”。

#### 风暴迅猛龙（二级 BOSS）

* **tough**：1.5
* 特殊技能**风刃乱舞**：三连击，每击倍率 0.5×，间隔 0.1s，冷却15s，后摇1s。
* AI：**风刃乱舞**冷却好时立刻释放，否则释放“普通攻击”。

#### 幼龙（三级 BOSS）

* **tough**：1.5
* 特殊技能**龙炎**：倍率 5.0×，冷却10s，蓄力0.5s，后摇1s。
* AI：**龙炎**冷却好时立刻释放，否则释放“普通攻击”。

#### 腐沼树妖（四级 BOSS）

* **tough**：1.6（更抗）
* **节奏**：1.8s 基础；**缠根**（小 1.6× + 短禁锢）；**横扫**（大 3.6×，前摇 0.6s）。

#### 暗影祭司（四级 BOSS）

* **tough**：1.5
* **节奏**：1.6s 基础；**暗影标记**（小 1.6×，被标记者 4s 内受一次额外 0.8× 追击）

#### 堕落大法师（五级 BOSS）

* **tough**：1.5
* **节奏**：法阵蓄念（中 2.4× 环形爆）、**黑曜矢**（小 1.6× 多段弹），**终招 6.0×** 长读条+大范围。

#### 恐惧骑士（五级 BOSS）

* **tough**：1.6
* **节奏**：1.5s 基础；**处决**（大 3.6×，对低血目标增伤），**盾反**（成功则对方 0.5s 眩晕）。

#### 地狱军阀（六级 BOSS）

* **tough**：1.6
* **节奏**：1.6s 基础；**怒潮（8sCD）**：4s 内攻速 ×1.3（倍率 0.9×）；**战吼**：周围敌人 DEF -10%（10s）。

#### 远古龙王（六级 BOSS）

* **tough**：**1.8**
* **节奏**：1.8s 基础；**龙息**（大 3.6×，直线扫灼）、**龙翼震荡**（中 2.4× + 击退）、**龙尾横扫**（小 1.6×，背后优先）。
* **BP**：≈ **8000**；终招**星界咆哮**：**6.0×**，长读条，全场压制。

#### 绽辉女王（七级 BOSS）

* **tough**：1.6
* **节奏**：1.7s 基础；**花雨**（多段小 1.6× DOT）、**花冠护域**（5s 内 DEF +15%），**召唤花仆**（小怪两只）。
* **特化**：**Mystic/Defender 混合**
* **BP**：七级中位×2.5 ≈ **9500**

### 地图列表

| 地图 ID | 名称 | 地图类型 | 解锁条件 |
|---|---|---|---|
| `florence` | 翡冷翠 | 城市 | 默认解锁 |
| `fringe` | 青苔原 | 野外 | 默认解锁 |
| `spine-of-frostfire` | 熔冰之脊 | 野外 | 击败黄金绵羊 |
| `thunderveil-keep` | 雷隐堡垒 | 野外 | 击败风暴迅猛龙 |
| `bogroot-expanse` | 腐沼根海 | 野外 | 击败幼龙 |
| `duskfang-rift` | 暮影裂谷 | 野外 | 击败腐沼树妖 |
| `gloomlit-arcanum` | 暗辉法枢 | 野外 | 击败暗影祭司 |
| `obsidian-windscar` | 黑曜风痕 | 野外 | 击败堕落大法师 |
| `frostfire-maelstrom` | 霜焰裂潮 | 野外 | 击败恐惧骑士 |
| `astral-crown` | 星界王座 | 野外 | 击败地狱军阀 |
| `green-elysium` | 绿野仙境 | 野外 | 击败远古龙王 |

### 已知BUG
* 怪物AI中有概率释放多连击时，在时间线上显示不正确（只显示一根竖条，后续追击只在第一击结算后出现，导致没法预判闪避）
